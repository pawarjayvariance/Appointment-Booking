generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id           String        @id @default(uuid())
  name         String
  status       String        @default("active") // active, suspended
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  users        User[]
  doctors      Doctor[]
  appointments Appointment[]
  reviews      Review[]
  timeSlots    TimeSlot[]
}

model Doctor {
  id             String        @id @default(uuid())
  userId         String?       @unique
  user           User?         @relation(fields: [userId], references: [id])
  name           String
  specialization String
  timezone       String
  workingStart   String        @default("09:00")
  workingEnd     String        @default("17:00")
  slotDuration   Int           @default(60)
  timeSlots      TimeSlot[]
  appointments   Appointment[]
  reviews        Review[]
  tenantId       String?
  tenant         Tenant?       @relation(fields: [tenantId], references: [id])
}

model TimeSlot {
  id          String       @id @default(uuid())
  doctorId    String
  doctor      Doctor       @relation(fields: [doctorId], references: [id])
  date        DateTime     @db.Date
  startTime   DateTime
  endTime     DateTime
  isBooked    Boolean      @default(false)
  appointment Appointment?
  tenantId    String?
  tenant      Tenant?      @relation(fields: [tenantId], references: [id])
}

model Appointment {
  id             String   @id @default(uuid())
  doctorId       String
  doctor         Doctor   @relation(fields: [doctorId], references: [id])
  timeSlotId     String   @unique
  timeSlot       TimeSlot @relation(fields: [timeSlotId], references: [id])
  name           String
  email          String
  note           String?
  createdAt      DateTime @default(now())
  userId         String
  user           User     @relation(fields: [userId], references: [id])
  additionalInfo Json?
  tenantId       String?
  tenant         Tenant?  @relation(fields: [tenantId], references: [id])

  @@index([doctorId])
  @@index([userId])
  @@index([tenantId])
}

model Review {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  doctorId  String
  doctor    Doctor   @relation(fields: [doctorId], references: [id])
  rating    Int      @default(5)
  feedback  String?
  createdAt DateTime @default(now())
  tenantId  String?
  tenant    Tenant?  @relation(fields: [tenantId], references: [id])

  @@index([userId])
  @@index([doctorId])
  @@index([tenantId])
}

enum Role {
  user
  doctor
  admin
  super_admin
}

model User {
  id           String        @id @default(uuid())
  name         String
  email        String        @unique
  passwordHash String
  profilePic   String?
  role         Role          @default(user)
  createdAt    DateTime      @default(now())
  appointments Appointment[]
  reviews      Review[]
  doctor       Doctor?
  tenantId     String?
  tenant       Tenant?       @relation(fields: [tenantId], references: [id])

  @@index([tenantId])
}
